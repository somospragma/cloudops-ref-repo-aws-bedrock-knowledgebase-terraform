# Módulo Terraform: bedrock-knowledge-base

<!-- Generated by Amazon Q Developer -->

## Descripción

Este módulo gestiona la creación y configuración de Knowledge Bases en AWS Bedrock con soporte para múltiples tipos de fuentes de datos. Proporciona una interfaz unificada para desplegar bases de conocimiento con diferentes configuraciones de almacenamiento y capacidades de ingesta de datos.

Para más detalles sobre los cambios y versiones, consulte el [CHANGELOG.md](./CHANGELOG.md).

## ✅ Características

- ✅ Soporte para múltiples tipos de almacenamiento (OpenSearch, Pinecone, RDS, Redis)
- ✅ Configuración flexible de fuentes de datos
- ✅ Integración con múltiples servicios (S3, Confluence, Salesforce, SharePoint)
- ✅ Configuración de ingesta vectorial
- ✅ Estrategias de chunking personalizables
- ✅ Sistema de etiquetado consistente
- ✅ Gestión de permisos IAM
- ✅ Soporte para cifrado KMS

## Estructura del Módulo

```
bedrock-knowledge-base/
├── README.md           # Este archivo
├── CHANGELOG.md        # Historial de cambios
├── main.tf            # Recursos principales
├── variables.tf       # Variables de entrada
├── outputs.tf         # Valores de salida
├── locals.tf          # Valores locales
└── providers.tf       # Configuración de proveedores
```

## Implementación y Configuración

### Requisitos Técnicos

- **Terraform**: >= 1.0
- **Provider AWS**: >= 4.31.0
- **Provider Archive**: >= 2.0
- **Provider Null**: >= 3.0
- **Provider Time**: ~> 0.9

### Provider Configuration

```hcl
terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = ">=4.31.0"
      configuration_aliases = [aws.project]
    }
    null = {
      source  = "hashicorp/null"
      version = ">= 3.0"
    }
    time = {
      source  = "hashicorp/time"
      version = "~> 0.9"
    }
    archive = {
      source  = "hashicorp/archive"
      version = ">= 2.0"
    }
  }
}
```

### Convenciones de Nomenclatura

Los recursos creados siguen la convención:
```
{client}-{project}-{environment}-{knowledge-base-name}
```

Ejemplo: `pragma-genai-dev-kb-documentation`

### Estrategia de Etiquetado

El módulo aplica tags automáticamente siguiendo la estrategia corporativa:
- **Name**: Nombre del knowledge base generado
- Tags adicionales configurables por knowledge base

### Recursos Gestionados

- `aws_bedrockagent_knowledge_base`: Knowledge Bases en Bedrock
- `aws_bedrockagent_data_source`: Fuentes de datos para Knowledge Bases

### Parámetros de Entrada

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_knowledgebases"></a> [knowledgebases](#input_knowledgebases) | Mapa de configuración de Knowledge Bases | `map(object)` | `{}` | yes |
| <a name="input_client"></a> [client](#input_client) | Nombre del cliente para etiquetado | `string` | n/a | yes |
| <a name="input_project"></a> [project](#input_project) | Nombre del proyecto para etiquetado | `string` | n/a | yes |
| <a name="input_environment"></a> [environment](#input_environment) | Entorno de despliegue (dev, qa, pdn) | `string` | n/a | yes |
| <a name="input_common_tags"></a> [common_tags](#input_common_tags) | Tags comunes para todos los recursos | `map(string)` | `{}` | no |

### Estructura de Configuración

```hcl
knowledgebases = {
  kb-name = {
    description = "Descripción del Knowledge Base"
    type        = "VECTOR"
    storage_configuration_type = "OPENSEARCH_SERVERLESS"
    
    vector_knowledge_base_configuration = {
      embedding_model_arn = "arn:aws:bedrock:region:account:embedding-model/model-name"
      dimensions         = "1536"
    }
    
    storage_configuration = {
      opensearch_serverless_configuration = {
        collection_arn = "arn:aws:aoss:region:account:collection/name"
        field_mapping = {
          metadata_field = "metadata"
          text_field     = "text"
          vector_field   = "vector"
        }
        vector_index_name = "vector-index"
      }
    }
    
    data_sources = [
      {
        name        = "documentation"
        description = "Technical documentation"
        
        data_source_configuration = {
          type = "S3"
          s3_configuration = {
            bucket_arn         = "arn:aws:s3:::bucket-name"
            inclusion_prefixes = ["docs/"]
          }
        }
        
        vector_ingestion_configuration = {
          chunking_configuration = {
            chunking_strategy = "FIXED_SIZE"
            fixed_size_chunking_configuration = {
              max_tokens         = 1000
              overlap_percentage = 20
            }
          }
        }
      }
    ]
    
    role_arn = "arn:aws:iam::account:role/knowledge-base-role"
    additional_tags = {
      Purpose = "documentation"
      Team    = "ai"
    }
  }
}
```

### Valores de Salida

| Name | Description |
|------|-------------|
| <a name="output_agents"></a> [agents](#output_agents) | Información completa sobre todos los knowledge bases creados |

### Ejemplos de Uso

#### Ejemplo 1: Knowledge Base Simple con OpenSearch

```hcl
module "knowledge_base" {
  source = "./modules/bedrock-knowledge-base"
  
  client      = "pragma"
  project     = "genai"
  environment = "dev"
  
  knowledgebases = {
    documentation = {
      description = "Technical Documentation KB"
      type        = "VECTOR"
      storage_configuration_type = "OPENSEARCH_SERVERLESS"
      
      vector_knowledge_base_configuration = {
        embedding_model_arn = "arn:aws:bedrock:us-east-1:123456789012:embedding-model/amazon.titan-embed-text-v1"
      }
      
      storage_configuration = {
        opensearch_serverless_configuration = {
          collection_arn = aws_opensearchserverless_collection.main.arn
          field_mapping = {
            metadata_field = "metadata"
            text_field     = "text"
            vector_field   = "vector"
          }
          vector_index_name = "vectors"
        }
      }
      
      role_arn = aws_iam_role.kb_role.arn
    }
  }
}
```

## Consideraciones Operativas

### Performance
- Optimización de configuración de chunking
- Selección adecuada del modelo de embeddings
- Configuración óptima del almacenamiento

### Monitoreo
- Métricas de ingesta de datos
- Estado de las fuentes de datos
- Uso de recursos

### Seguridad
- Roles IAM con permisos mínimos
- Cifrado de datos en reposo
- Control de acceso granular

## Seguridad y Cumplimiento

### Controles de Seguridad
- Validación de configuraciones de entrada
- Roles IAM específicos por knowledge base
- Cifrado KMS para datos sensibles

### Cumplimiento
- Nomenclatura estándar corporativa
- Trazabilidad completa de recursos
- Auditoría de cambios y accesos

## Observaciones

- **Límites de Almacenamiento**: Varían según el backend seleccionado
- **Costos**: Considerar costos de embeddings y almacenamiento
- **Regiones**: Verificar disponibilidad de servicios por región
- **Modelos**: Compatibilidad con diferentes modelos de embeddings